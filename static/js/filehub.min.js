/* filehub
 * Copyright (c) 2016 RaphaÃ«l Bois Rousseau
 * MIT Licensed
 */
var PROD=!0;!function(a,b,c){"use strict";function d(a,b,c,d,e){e||(e=a);var f=b[a];"function"==typeof f&&"function"!==d&&(f=f.call(b,a,c)),null==f||d&&typeof f!==d||c[e](f)}var e=(b.FILEHUB_BASEURL||"",b.filehub=function(){var a,c,d=b.FILEHUB_CTX;if(e.setup(),d&&"function"==typeof e["ctx:"+d]){a=b.FILEHUB_OBJ=e["ctx:"+d](),a.context=d,c=e["post:"+d]||[];for(var f=0;f<c.length;f++)c[f]&&"function"==typeof c[f]&&c[f].call(a)}});"undefined"!=typeof console&&console.log&&b.FILEHUB_DEBUG?e.debug=console.log.bind(console):e.debug=function(){};var f=e.debug,g=0;e.register=function(a,b,c,d){var f;if("boolean"!=typeof a&&(d=c,c=b,b=a,a=!1),"string"!=typeof b)throw Error("register(): first argument must be a string");if(f=(a?"post":"ctx")+":"+b,c&&"function"!=typeof c)throw Error("register(): second argument must be a function or null");return c&&(a?(e[f]||(e[f]=[]),e[f].push(c),g++):c&&(e[f]=c)),"function"==typeof d&&(e.setup._load[a?"post"+g:b]=d),c};var h;e.setup=function(){function a(a,b,c){b.call(e)===!1?c.push({ctx:a,fn:b}):f("  '%s' loaded",a)}if(!h){h=!0;var b=[];f("Running setup functions...");for(var c in e.setup._load)a(c,e,b);for(var d,g=b.length,i=[];g;){if(!b.length){if(!i.length)break;if(i.length===g)throw Error("setup(): Some setup functions requirements couldn't be satisfied.");b=i,i=[],g=b.length}d=b.pop(),a(d.ctx,d.fn,i)}f("done.")}},e.setup._load={},e.support={pointerEvents:function(){var a,c=document.createElement("x"),d=document.documentElement,e=b.getComputedStyle;return"pointerEvents"in c.style?(c.style.pointerEvents="auto",c.style.pointerEvents="x",d.appendChild(c),a=e&&"auto"===e(c,"").pointerEvents,d.removeChild(c),!!a):!1}(),pushState:function(){return b.history&&"function"==typeof b.history.pushState}()},e.ease={inOutQuad:function(a,b,c,d){return d>0?(a/=d/2,1>a?b+a*a*c/2:(a--,b-(a*(a-2)-1)*c/2)):b+c}},e.build=function(b){var c,f,g=[];a.isArray(b)||(b=[b]);for(var h=0;h<b.length;h++)c=b[h],c&&("function"!=typeof c.cond||c.cond.call(c))&&(f=a("<"+(c.tag||"div")+"/>"),d("addClass",c,f,"string"),d("text",c,f,"string"),d("html",c,f,"string"),d("attr",c,f,"object"),d("prop",c,f,"object"),d("css",c,f,"object"),a.isArray(c.append)&&f.append(e.build(c.append)),a.isArray(c.prepend)&&f.prepend(e.build(c.prepend)),g=g.push(f.get(0)));return a(g)},e.modMask=function(a){return(a.ctrlKey?1:0)+(a.altKey?2:0)+(a.shiftKey?4:0)},e.messageBox=function(a,b,c){return c=c||"message",a.addClass(c+"-box"),a.children().length||a.append(e.build([{addClass:c+"-wrap",append:[{addClass:"padding-box1"},{addClass:"fixed-box",append:[{tag:"h1",text:"string"==typeof b?b:b.title||"-"},{tag:"p",addClass:"note",cond:function(){return!!b.message},text:b.message}]},{addClass:"padding-box2"}]}])),a},e.errorBox=function(a,b){return e.messageBox(a,{title:b&&b.title||"Unexpected error",message:b&&b.message||"An unexpected error occured."},"error")},e.createClass=function(b,c){if(!b)throw Error("class name required");c=c||{};var d=function(b){this.options=a.extend(!0,{},this.options||{},b||{}),this._actions={},"function"==typeof this._init&&this._init()},f=d.prototype;return e[b]=d,f._getAction=function(b){return this._actions[b]||(this._actions[b]=a.Callbacks()),this._actions[b]},f.on=function(b){var c=this;if("string"==typeof b){if(1===arguments.length)return;var d=c._getAction(b);d.add.apply(d,Array.prototype.slice.call(arguments,1))}else"object"==typeof b&&a.each(b,function(a,b){c._getAction(a).add(b)});return c},f.off=function(b){var c,d=this;if("string"==typeof b){if(c=d._actions[b],!c)return;if(arguments.length>1&&(c.remove.apply(c,Array.prototype.slice.call(arguments,1)),c.has()))return;delete d._actions[b]}else"object"==typeof b&&a.each(b,function(b,c){a.isArray(c)?(c=c.slice(0),c.shift(b),d.off.apply(d,c)):c?d.off(b,c):d.off(b)});return d},f.trigger=function(a,b){var c=this._actions[a];if(c)return c.fireWith(this,b||[]),this},a.extend(f,c),d},a(e)}(jQuery,window),function(a,b,c){"use strict";var d=b.filehub;Array.prototype.join,Array.prototype.slice,d.createClass("Api",{options:{apiUrl:(b.FILEHUB_BASEURL||"")+"/api"},_init:function(){this.FILE_RE=new RegExp("^/[^/]+/.*[^/]$")},get:function(b,c){return a.ajax(this.options.apiUrl+(b||""),{method:"GET",accepts:{json:"application/json"},cache:!1,data:c,dataType:"json"})},head:function(b,c){return a.ajax(this.options.apiUrl+(b||""),{method:"HEAD",cache:!1,data:c})},post:function(b,c){return null!=c&&"string"!=typeof c&&(c=JSON.stringify(c)),a.ajax(this.options.apiUrl+(b||""),{method:"POST",accepts:{json:"application/json"},contentType:"application/json",cache:!1,data:c||"{}",dataType:"json"})},put:function(b,c){return null!=c&&"string"!=typeof c&&(c=JSON.stringify(c)),a.ajax(this.options.apiUrl+(b||""),{method:"PUT",accepts:{json:"application/json"},contentType:"application/json",cache:!1,data:c||"{}",dataType:"json"})},del:function(b){return a.ajax(this.options.apiUrl+(b||""),{method:"DELETE",accepts:{json:"application/json"},cache:!1,dataType:"json"})},stat:function(a){return this.get("/repo/stat",{path:a})},sendFileUrl:function(a,b,c){var d,e=a.replace(/\/+$/,"")+"/"+b.name;return d=("/repo/"+e+(c?"?replace=1":"")).replace(/\/\/+/g,"/"),this.options.apiUrl+d},getFile:function(a){return"/"!=a[0]&&(a="/"+a),this.FILE_RE.test(a)?(b.location.assign(this.options.apiUrl+"/repo"+a+"?attachment=1"),!0):!1},list:function(a,b){return this.get("/repo"+(a||"/"),{tree:b?1:0})},exists:function(a){return this.head("/repo"+(a||"/"))},trash:function(a){return this.del("/repo"+a)},createFolder:function(a,b){return b=b||{},b.name=a,this.post("/repo/",b)},updateFolder:function(a,b){return this.put("/repo/"+a+"/",b||{})},createDir:function(a,b){return this.put("/repo"+a+(b?"?parents=1":""))},trashList:function(){return this.get("/trash")},trashEmpty:function(){return this.del("/trash")},trashGet:function(a){return this.get("/trash/"+a)},trashDel:function(a){return this.del("/trash/"+a)},account:function(a){return this.get("/account/"+a)},accountExists:function(a){return this.head("/account/"+a)},accountUpdate:function(a,b){return this.put("/account/"+a,b||{})},accountDelete:function(a){return this.del("/account/"+a)},accountsList:function(a){var b=[];return a.accessLevel&&b.push("accessLevel="+a.accessLevel),a.email&&b.push("email="+a.email),this.get("/accounts"+(b.length?"?"+b.join("&"):""))},accountCreate:function(a,b,c,d){var e={username:a,password:b};return c&&(e.email=c),d&&(e.accessLevel=d),this.post("/accounts",e)}})}(jQuery,window),function(a,b,c){"use strict";var d=b.filehub;d.createClass("Aside",{options:{idPrefix:"t-",aside:"#view-aside",expandSelector:".fa",expandClasses:"fa-caret-right fa-caret-down"},_init:function(){var b=this,c=b.options;b.aside=a(c.aside),b.buttonBox=b.aside.children(".button-box"),b.treeBox=b.aside.children(".tree-box"),b.treeIdPrefix=b.treeBox.data("id-prefix")||"t-",b.buttonBox.on("click","button",function(c){var d=a(this);d.prop("disabled")||b.trigger("button",[d])}),b.treeBox.on("click",".tree-item-subtree > .tree-expand",function(b){var d=a(this).children(c.expandSelector);d.toggleClass(c.expandClasses),a(this).closest(".tree-item").next(".tree").slideToggle(300)}).on("click",".tree-item",function(c){var d=a(this);a(c.target).closest(".tree-expand").length||d.hasClass("active")||b.select(null,d)})},enable:function(a){var b=this.buttonBox.find("button");0===arguments.length&&(a=!0),b.prop("disabled",!a)},resize:function(a){this.aside.width(a)},width:function(){return this.aside.width()},select:function(b,c){var d=this,e=d.options;if(b||c?b?c||(c=a("#"+e.idPrefix+b)):b=c.data("uid"):c=d.treeBox.find(".tree-item:eq(0)"),!c.hasClass("active")){if(d.treeBox.find(".active").treeItemActive(!1),c.hasClass("tree-item")){c.treeItemActive(!0);for(var f=c.closest(".tree");f.length&&!f.is(":visible");)f=f.prev(".tree-item"),f.children(".tree-expand").click(),f=f.parent(".tree")}d.trigger("select",[b,c])}},update:function(b,c){var d,e,f=this,g=f.options,h=a("#"+g.idPrefix+b),j=h.next(".tree"),k=g.expandClasses.split(/ +/),l=[];if(!h.length||!c||!c.length)return void j.remove();for(j.empty(),d=h.children(".tree-pad").length,l.push({items:c,i:0,tree:j});l.length;)for(e=l.pop();e.i<e.items.length;e.i++){var m=e.items[i];a("div").treeItem({label:m.label,icon:m.icon,subtree:m.subtree&&m.subtree.length>0,expand:m.subtree?{off:k[0],on:k[1]}:!1,depth:d+l.length,idPrefix:g.idPrefix,uid:m.uid,active:m.active,"class":m["class"],data:m.data}).appendTo(e.tree);m.subtree&&m.subtree.length&&(l.push(e),e={items:m.subtree,i:0,tree:a('<div class="tree"/>').hide().appendTo(e.tree)})}}});a.fn.treeItem=function(a){var b=a.icon;if(this.empty().addClass("tree-item").toggleClass("tree-item-subtree",a.subtree).addClass(a["class"]||""),"string"==typeof b&&(b={off:b,on:b}),this.append(d.build([{addClass:"tree-expand",append:[{tag:"span",addClass:a.subtree&&a.expand?a.expand.off:""}]},{addClass:"tree-icon",append:[{tag:"span",addClass:b?b.off:""}]},{addClass:"tree-label",text:a.label||""}])),a.depth>0)for(var c=0;c<a.depth;c++)this.prepend('<div class="tree-pad"/>');a.uid&&(this.attr("id",a.idPrefix+a.uid),this.data("uid",a.uid)),"object"==typeof a.icon&&this.data({"ico-on":a.icon.on,"ico-off":a.icon.off}),this.data(a.data||{}),a.active&&this.treeItemActive()},a.fn.treeItemActive=function(a){a=0===arguments?!0:!!a,this.toggleClass("active",a);var b=this.data("ico-on"),c=this.data("ico-off");return b&&c&&this.find(".tree-icon > span").removeClass(c+" "+b).addClass(a?b:c),this}}(jQuery,window),function(a,b,c,d){"use strict";function e(b,c){c.sort(function(a,b){var c=a.data("key"),d=b.data("key");return d>c?-1:c>d?1:0}),a.fn.prepend.apply(b,c)}var f=b.filehub;f.createClass("AccessList",{options:{api:null,dialog:"#acl_dialog"},_init:function(){var b,c,d,e,g=this,h=g.options;g.api=h.api||new f.Api,g.dialog=b=a(h.dialog),g.title=b.find(".modal-title"),b.modal({show:!1}),c=g.aclLoading={body:b.find(".acl-loading"),btn:b.find(".acl-btnLoading")},c.all=a([c.body.get(0),c.btn.get(0)]),d=g.aclList={body:b.find(".acl-list"),ul:b.find(".acl-list > ul"),btn:b.find(".acl-btnList")},d.all=a([d.body.get(0),d.btn.get(0)]),d.user=d.ul.children("li.user").eq(0).detach(),d.add=d.ul.children("li.add").children("button"),d.add.on("click",function(c){c.preventDefault(),g.aclAll.hide(),e.all.show(),b.modal("handleUpdate"),e.div.find("input").each(function(){var b=a(this);b.prop("checkbox",!!b.attr("checkbox"))})}),e=g.aclSelect={body:b.find(".acl-select"),div:b.find(".acl-select > div.users"),btn:b.find(".acl-btnSelect")},e.all=a([e.body.get(0),e.btn.get(0)]),g.aclAll=a([c.body.get(0),c.btn.get(0),d.body.get(0),d.btn.get(0),e.body.get(0),e.btn.get(0)]),b.on("show.bs.modal",function(a){g.aclAll.hide(),c.all.show()}),b.find(".modal-footer").on("click","button",function(){var c=a(this).data("action");switch(c){case"cancel":b.trigger("abort.fh");break;case"cancel-select":g.aclAll.hide(),d.all.show(),b.modal("handleUpdate");break;case"select":b.trigger("select.fh");break;case"update":b.trigger("update.fh")}}),g.counter=0},edit:function(a,b,c){var d=this,e=++d.counter,f=d.dialog;d.title.text(d.title.data("text").replace("{folder}",a)),d.pendingAjax&&(d.pendingAjax.abort(),delete d.pendingAjax),f.modal("show"),f.one("abort.fh.fh"+e,function(a,b,d){f.off(".fh"+e),f.modal("hide"),b&&c(b,d)}).on("select.fh.fh"+e,function(a){d._select()}).one("update.fh.fh"+e,function(g){f.off(".fh"+e),f.modal("hide"),d._update(a,b,c)}),d.pendingAjax=d.api.stat(a).done(function(a,b,c){d.pendingAjax=d.api.accountsList({accessLevel:"user"}).done(function(b,c,e){var f=a&&a.accessList||{},g=b&&b.user||{};delete d.pendingAjax,d.populate(f,g)}).fail(function(a,b,c){delete d.pendingAjax,f.trigger("abort.fh","abort"!==c?[JSON.parse(c),a]:[])})}).fail(function(a,b,c){delete d.pendingAjax,f.trigger("abort.fh","abort"!==c?[JSON.parse(c),a]:[])})},populate:function(b,c){var d,f,g,h,i,j,k=this,l=k.aclList,m=k.aclSelect,n=0,o={};for(l.ul.children(".user").remove(),g=[],d=0;d<c.length;d++)f=c[d].username,o[f]=c[d],h="acl_u"+ ++n,i=a('<input id="'+h+'" type="checkbox"/>').val(f),o[f].ckb=i,j=a('<label for="'+h+'"/>').text(f),null!=b[f]&&i.prop("defaultChecked",!0),g.push(a("<div/>").attr("data-key",f).data("key",f).append(i,"&nbsp;",j));g.length&&m.div.empty().append.apply(m.div,g),k._addUser=function(b,c){var d=l.user.clone();return d.data("key",b),d.children("button").on("click",function(c){var d=a(this);c.preventDefault(),c.stopPropagation(),d.parent().remove(),o[b].ckb.prop("defaultChecked",!1)}),d.children("span.username").text(b),d.children("select").val("rw"===c?"rw":"ro"),d},g=[];for(f in b)o[f]&&g.push(k._addUser(f,b[f]));g.length&&e(l.ul,g),k.aclAll.hide(),l.all.show(),k.dialog.modal("handleUpdate")},_update:function(b,c,d){var e=this,f={},g=0;e.aclList.ul.children(".user").each(function(){var b=a(this),c=b.data("key");f[c]=b.children("select").val()||"ro",g++}),e.pendingAjax=e.api.updateFolder(b,{accessList:f}).done(function(){delete e.pendingAjax,c(f,g)}).fail(function(a,b,c){delete e.pendingAjax,c&&c!==abort&&d(JSON.parse(c),a)})},_select:function(){var b=this,c=[],d=b.aclList.ul.children(".user").detach().toArray(),e=d.length?a(d[0]):a(),f=e.data("key");b.aclSelect.div.children().each(function(){var g=a(this),h=g.data("key");if(g.children("input").prop("checked")){for(;d.length&&h>f;)d.shift(),e=d.length?a(d[0]):a(),f=e.data("key");h===f?c.push(e):c.push(b._addUser(h)),g.children("input").prop("defaultChecked",!0)}}),a.fn.prepend.apply(b.aclList.ul,c),b.aclAll.hide(),b.aclList.all.show(),b.dialog.modal("handleUpdate")}})}(jQuery,window,document),function(a,b,c){"use strict";function d(a,c){e.support.pushState?b.history.pushState(c,"",a):location.assign(a)}var e=b.filehub,f={itemDelete:function(a){},trashRestore:function(a){},trashRemove:function(a){}};e.register("browse",function(){function g(b,c){var d=c.row&&c.row.hasClass("view-droppable")&&c.row.data("flags").indexOf("w")>=0,e=c.list&&c.list.data("flags").indexOf("w")>=0&&c.list.data("flags").indexOf("s")<0;n&&n.removeClass("view-dragover"),n=d?c.row:e?c.list:a(),n.addClass("view-dragover")}function h(a,b){n&&(n.removeClass("view-dragover"),n=c)}function i(a,b){var c,d=a.dataTransfer||(a.originalEvent||{}).dataTransfer;if(h(),d&&d.files&&d.files.length){if(b.row&&b.row.hasClass("view-droppable")&&b.row.data("flags").indexOf("w")>=0)c=b.row;else{if(!(b.list&&b.list.data("flags").indexOf("w")>=0&&b.list.data("flags").indexOf("s")<0))return;c=b.list}self.sendQueue||(self.sendQueue=new e.SendQueue({api:l})),self.sendQueue.queue(d.files,{path:c.data("path")})}}var j,k=e.View,l=new e.Api,m=new k({dropzone:!0});m.ACTIONS=f,m.api=l,m.on("refresh",function(a,b){j||d(b.data("url"),{ctx:this.context,url:b.data("url"),uid:a});var c,e=[],f=!0;do e.unshift({label:b.children(".tree-label").text(),cls:"subdir"+(f?"":" act"),data:{uid:b.data("uid")}}),f=!1,c=b.closest(".tree"),b=c.prev(".tree-item");while(b.length);this.nav.update(e)}).on("load",function(b,c,d){var e=this;e.sidePanel.enable(!1),a.get(c.data("url")+"?list-only=1",function(b){var c=a("<div/>").html(b).children(".list-box");c.length?d(null,c):d({statusCode:404,textStatus:"error",error:"Not Found"})}).fail(function(a,b,c){d({statusCode:a.statusCode(),textStatus:b,error:c})})}).on("activate",function(a){switch(a.data("type")){case"folder":this.sidePanel.select(a.data("uid"));break;default:l.getFile(a.data("path"))}}).on("view",function(a){this.sidePanel.enable((a.data("flags")||"").indexOf("w")>=0)}).on("select",function(b){var c=this.viewActive,d={},e=0;b.each(function(){var b=a(this),c=b.data("type");d[c]||(e++,d[c]=!0)}),this.nav.actions().each(function(){var f=a(this),g=f.data("select")||"single",h=(f.data("target")||"*").split("|"),i=h[1],j=h[2],k=!1;h=h[0];do{if(!b||!b.length)break;if(b.length>1&&"single"===g)break;if(j&&!c.is(j))break;if(i&&c.data("flags").indexOf(i)<0)break;if("*"!==h&&(1!==e||!d[h]))break;k=!0}while(0);f.toggle(k)})}).on("action",function(a,b){var c=this.getSelected(),d=this.ACTIONS[a];d&&"function"==typeof d&&d.call(this,c,b)}).on({dragenter:g,dragupdate:g,dragleave:h,drop:i});var n;return a(b).on("popstate",function(a){var b=a.originalEvent.state;b&&b.ctx===m.context&&(j=!0,m.sidePanel.select(b.uid),j=!1)}),m})}(jQuery,window),function(a,b,c){"use strict";var d=b.filehub;d.createClass("ListLoader",{options:{container:null},_init:function(){var b=this,c=b.options;b.container=a(c.container||[]),b.loader=b.container.children(".list-loader"),b.hide()},show:function(){this.loader.fadeIn("fast")},hide:function(){this.loader.fadeOut("fast")}})}(jQuery,window),function(a,b,c){"use strict";var d=b.filehub;d.createClass("Nav",{options:{nav:"#nav",navPadding:"#nav-padding",navPath:"#nav-path",navTools:"#nav-tools",pathSeparator:'<span class="fa fa-chevron-right"/>'},_init:function(){var b=this,c=b.options;a.each(["nav","navPadding","navPath","navTools"],function(d,e){b[e]=a(c[e])}),b.navPath.on("click",".navitem",function(c){var d=a(this);c.preventDefault(),c.stopPropagation();var e=d.data("uid");null!=e&&b.trigger("activate",[""+e,d])}),b.navTools.on("click",".view-action",function(c){var d=a(this);b.trigger("action",[d.data("action"),d])})},actions:function(){return this.navTools.children(".view-action")},padding:function(a){this.navPadding.width(a)},update:function(b){var c=this,d=c.navPath.children().detach(),e=a(c.options.pathSeparator||"<span/>");b?a.isArray(b)||(b=[b]):b=[];for(var f=0;f<b.length;f++){var g=b[f];if(f<d.length){if(null==g){c.navPath.append(d.get(f));continue}d=a()}null==g?g={}:"string"==typeof g&&(g={label:g}),a("<li/>").navItem(0==f,g.label||"-",g.cls||"",g.data||{},e).appendTo(c.navPath)}}});a.fn.navItem=function(b,c,d,e,f){return"boolean"!=typeof b&&(e=d,d=c,c=b,b=!1),this.empty(),!b&&f&&f.clone().appendTo(this),a('<span class="navitem"/>').addClass(d||"").data(e||{}).text(c||"").appendTo(this),this}}(jQuery,window),function(a,b,c){"use strict";var d=b.filehub,e=b.XMLHttpRequest;d.createClass("SendQueue",{options:{api:null,container:"#send-queue"},_init:function(){var b,c,e=this,f=e.options;e._queue=[],e.container=c=a(f.container),b=c.data("tl"),"string"==typeof b&&(b=JSON.parse(b||"{}")||{}),e.tl=b,e.toggle=c.find(".sq-tools .sq-toggle"),e.title=c.find(".title"),e.body=c.children(".sq-body"),e.wrap=e.body.children(".sq-wrap"),e.template=e.wrap.children(".sq-row:eq(0)").remove().hide(),e.api=f.api||new d.Api,e.toggle.on("click",function(){e._bodySlide()}),e.title.on("dblclick",function(){e._bodySlide()})},startNext:function(){var a,b,c=this;if(!c._sending||"sending"!==c._sending.status){do a=c._sending=c._queue.shift();while(a&&"pending"!==a.status);if(!a)return c.title.text(c.tl.title.complete),void c.trigger("complete");var d=c.tl.title.uploading;a.update=function(b){var e=c._queue.length,f=d.replace("{percent}",""+(null!=b?b:"??")).replace("{pending}",e);if(c.title.text(f),null==b){var g=10,h=90,i=30,j=h/2,k=2*(100-g)/h,l=Math.floor(1e3/i);a.pg.css({width:"10%",left:0}),a.pgl.text("..."),a.pginterval=function(){var b=setInterval(function(){var b;j=(j+1)%(h+1),b=Math.abs(h/2-j),a.pg.css({left:""+b*k+"%"})},l);return function(){b&&clearInterval(b),b=0}}()}else a.pg.css("width",""+b+"%"),a.pgl.text(""+Math.floor(b)+"%")},b=a.xhr=new e,function(a){for(var c in a)b.addEventListener(c,a[c])}({progress:function(b){return!b.total||a.pginterval?void(a.pginterval||a.update()):(a.loaded=b.loaded,a.total=b.total,void a.update(100*(b.loaded/b.total)))},load:function(d){a.pginterval&&a.pginterval(),a.pgl.text(c.tl.progress.done||"done"),a.pg.css({width:"100%",left:0}),a.loaded=a.total,a.status="done",200!==b.status?(a.status="error",a.row.addClass("error"),a.pg.hide(),a.pgl.text(c.tl.progress.aborted||"error"),c.trigger("error",[a,b])):c.trigger("uploaded",[a,b]),c.startNext()},abort:function(b){a.pginterval&&a.pginterval(),a.status="aborted",a.row.addClass("abort"),a.pg.hide(),a.pgl.text(c.tl.progress.aborted||"aborted"),c.trigger("abort",[a]),c.startNext()},error:function(d){a.pginterval&&a.pginterval(),"aborted"!==a.status&&(a.status="error",a.row.addClass("error"),a.pg.hide(),a.pgl.text(c.tl.progress.aborted||"error"),c.trigger("error",[a,b])),c.startNext()}}),a.update(0);var f=c.api.sendFileUrl(a.options.path,a.file,a.options.replace);b.open("PUT",f,!0),b.send(a.file)}},queue:function(a,b){for(var c=this,d=0;d<a.length;d++)c._queueOne(a[d],b,!0);c.reveal(),c.startNext()},_queueOne:function(a,b,c){var d=this,e=d.template.clone(),f={file:a,status:"pending",options:b,row:e,pg:e.find(".sq-progress-in"),pgl:e.find(".sq-progress-label")};e.children(".sq-label").text(a.name),e.appendTo(d.wrap).data("fh-sq",f).slideDown(),d._queue.push(f),c||(d.reveal(),d.startNext())},_bodySlide:function(b){function c(){d.toggle.children(".fa").each(function(){var b=a(this);b.toggle(e.is(b.data("target-is")))})}var d=this,e=d.body;switch(null==b&&(b=e.is(":visible")?"up":"down"),b){case"up":e.slideUp(c);break;case"down":e.slideDown(c)}},reveal:function(){var a=this;a.container.fadeIn(function(){a._bodySlide("down")})}})}(jQuery,window),function(a,b,c){"use strict";function d(b){var d=a(b.target),e=d.closest("."+y),f=e.data("dropId");return b.preventDefault(),b.stopPropagation(),{dropId:f,zone:e.length?e:c,view:f?B[f]:c}}function e(b,d){if(k||d){d&&(k=d);var e=a(b.target),f=e.closest(".list-box"),g=f.length?e.closest("."+s):a();k.list=f.length?f:c,k.row=g.length?g:c}}function f(a){k?1&a.buttons||g(a):p.off(".fhdragdetect")}function g(a,b){k&&(p.off(".fhdragdetect"),b||k.view.trigger("dragleave",[a,k]),k=c)}function h(a,b){g(a),e(a,b),null!=a.buttons&&p.on("mouseover.fhdragdetect",f),b.view.trigger("dragenter",[a,b])}function i(b){var c="v"+ ++C;B[c]=b,b.viewContents.addClass(y).data("dropId",c),j||(a("html").on("dragover"+r,function(a){var b=d(a);if(k)b.zone?b.dropId!=k.dropId?h(a,b):(e(a),k.view.trigger("dragupdate",[a,k])):g(a);else{if(!b.zone||!b.view)return;h(a,b)}}).on("dragenter"+r,function(a){a.preventDefault(),a.stopPropagation()}).on("dragleave"+r,function(a){a.preventDefault(),a.stopPropagation()}).on("drop"+r,function(a){var b=d(a);b.zone&&b.view&&(e(a,b),k&&(e(a),k.view.trigger("drop",[a,k]),g(a,!0)))}),j=!0)}var j,k,l=b.filehub,m=Math.abs,n=Math.max,o=Math.min,p=a(b),q=a(b.document),r=".fh-dropzone",s="list-row",t=s+"-selected",u=s+"-prev",v=s+"-orig",w=s+"-dragged",x="on-drag",y="view-drop-zone",z=x+"-copy",A="view-droppable-hover",B={},C=0;l.createClass("View",{options:{listIdPrefix:"l-",listExpire:300,viewResize:"#view-resize",viewContents:"#view-contents",dropzone:!1,shortcuts:{65:{1:"selectall"},46:{0:{eventname:"delete",rows:"."+t}},13:{0:{eventname:"activate",rows:"."+u}},32:{1:"cursortoggle"},38:{"*":{eventname:"cursorprevious",mods:!0}},40:{"*":{eventname:"cursornext",mods:!0}}}},_init:function(){var c=this,d=c.options;c._body=a(b.document.body),c.sidePanel=new l.Aside(d.aside),c.sidePanel.on("select",function(){c.trigger("refresh",arguments),c.loadTarget.apply(c,arguments)}).on("button",function(){c.trigger("button",arguments)}),c.nav=new l.Nav(d.nav),c.nav.on("activate",function(a){c.sidePanel.select(a)}).on("action",function(){c.trigger("action",arguments)}),c.viewResize=a(d.viewResize),c.viewContents=a(d.viewContents),c.viewActive=c.viewContents.children(".list-box:visible"),c.loader=new l.ListLoader({container:c.viewContents}),c._initResize(),c._initShortcuts(),c._initLists(),c._initDropZone()},_initResize:function(){var a,b,c=this,d=c.sidePanel,e=c.viewResize.children(".view-handle");e.on("mousedown",function(e){1===e.which&&(a=d.width(),b=e.pageX,p.on("mousemove.resize",function(e){var f=e.pageX-b,g=n(0,a+f);d.resize(g),c.nav.padding(g)}).on("mouseup.resize",function(a){1===a.which&&p.off(".resize")}))})},getRows:function(a){var b=this.viewActive.children(".list").children(".list-body").children("."+s);return a?b.filter(a):b},getSelected:function(){return this.getRows("."+t)},_selectFromOrigin:function(b,c){var d,e,f,g,h,i,j,k,l=this,c=c||l.getRows();return c.each(function(c){var g=a(this);return this===b.get(0)&&(d=c),g.hasClass(u)&&(e=c),g.hasClass(v)&&(f=c),!(e>=0&&f>=0&&d>=0)}),0>d?void 0:(f=0>f?0:f,e=0>e?f:e,g=o(f,e),h=n(f,e),i=o(d,f),j=n(d,f),c.each(function(b){var c;b>=g&&h>=b&&(c=!1),b>=i&&j>=b&&(c=!0),"boolean"==typeof c&&a(this).toggleClass(t,c)}),c.removeClass(u),b.addClass(u),k=c.filter("."+t),l.trigger("select",[k]),k)},_updateCursor:function(a,b){var c,d,e=this,f=e.getRows("."+u);if(!f.length){if(d=f=e.getRows(":first"),!f.length)return;c=!0}return a?(c||(d=f[c||0>a?"prev":"next"](),d.length||(d=f)),void(b?1===b?(f.removeClass(u),d.addClass(u)):4===b&&e._selectFromOrigin(d):(e.getRows().removeClass(t+" "+v+" "+u),d.addClass(t+" "+v+" "+u),e.trigger("select",[d])))):void(1===b&&(e.getRows().removeClass(v+" "+u),f.toggleClass(t+" "+v+" "+u),e.trigger("select",[e.getSelected()])))},_initShortcuts:function(){var b=this;q.on("keydown.list-shortcuts",function(c){if(!b._body.hasClass(x)&&!a(c.target).closest("a,button,input,textarea,.dialog").length&&!b._scDisabled){var d,e,f=b.options.shortcuts,g=l.modMask(c),h=c.keyCode||c.which,i=[];e=f[h],e&&(d=g in e?e[g]:e["*"],"string"==typeof d&&(d={eventname:d}),d&&d.eventname&&(d.mods&&i.push(g),null!=d.rows&&i.push(b.getRows(d.rows)),c.preventDefault(),b.trigger(d.eventname,i)))}})},_initLists:function(){var b=this;b.on("selectall",function(){var a=b.getRows();a.removeClass(v).addClass(t),b.trigger("select",[a])}).on("unselectall",function(){b.getRows().removeClass(t+" "+v),b.trigger("select",[a()])}).on("cursorprevious",function(a){b._updateCursor(-1,a)}).on("cursornext",function(a){b._updateCursor(1,a)}).on("cursortoggle",function(){b._updateCursor(0,1)}),b.viewContents.on("mousedown","."+s,function(d){function e(a){a=a||0,n.removeClass(u),o.removeClass(v),n=o=g.addClass(u+" "+v),1&a||r.removeClass(t),g.toggleClass(t,1&a?c:!0),r=k.filter("."+t),b.trigger("select",[r])}function f(){var c,f,h=null,j=d.pageX,k=d.pageY;q.on("keydown.viewdrag keyup.viewdrag",function(a){b._body.toggleClass(z,a.ctrlKey)}),p.on("mousemove.viewdrag",function(d){var e;if(!c){if(c=m(j-d.pageX)+m(k-d.pageY)>2,!c)return;b._body.addClass(x).toggleClass(z,d.ctrlKey),r.addClass(w),f=b._dragInit(g,r,d.pageX,d.pageY)}h&&h.removeClass(A),e=a(d.target).closest(".view-droppable"),e=e.not(".active,."+t),h=e.length?e:null,h&&(f.each(function(){var b=a(this).data("dnd-row-src"),c=b.data("target");return c&&c===h.data("target")?(h=null,!1):void 0}),h&&h.addClass(A))}).on("mouseup.viewdrag",function(a){1===a.which&&(r.removeClass(w),b._body.removeClass(x+" "+z),p.off(".viewdrag"),q.off(".viewdrag"),f&&f.remove(),h?h.removeClass(A):c||4&i||e())})}if(1===d.which){var g=a(this),h=g.hasClass(t),i=l.modMask(d),j=g.closest(".list"),k=j.children(".list-body").children("."+s),n=k.filter("."+u),o=k.filter("."+v),r=k.filter("."+t);!h||1&i||f(),5!==(5&i)&&(4&i?r=b._selectFromOrigin(n=g,k):(1&i||!h)&&(e(i),1&i||f()))}}).on("dblclick","."+s,function(c){b.trigger("activate",[a(this)])}).on("mousedown",function(c){1===c.which&&(a(c.target).closest("."+s).length||b.trigger("unselectall"))})},_dragRow:function(b,c){var d,e,f=a('<div class="dnd-row"/>').toggleClass("dnd-row-other",!!c),g=b.children(".list-cell:eq(0)").children(".list-cell-content");return f.append(g.clone()),f.data("dnd-row-src",b),this._body.append(f),d=b.offset(),e=b.innerWidth(),f.offset(d).width(e),f.on("movetopointer.viewdrag",function(a){var b={left:a.pageX+1+(c?3:0),top:a.pageY+1+(c?3:0)};l.support.pointerEvents||(b.left+=20),f.offset(b)}).get(0)},_dragInit:function(b,c,d,e){var f=this,g=a(),h=a.Event("movetopointer.viewdrag");if(h.pageX=d,h.pageY=e,c.each(function(c){g=g.add(f._dragRow(a(this),this!==b.get(0)))}),g.width(0).trigger(h),g.length>1){var i=a('<div class="dnd-count"/>').text(g.length);g.not(".dnd-row-other").append(i.hide().fadeIn())}return p.on("mousemove.viewdrag",function(a){h.pageX=a.pageX,h.pageY=a.pageY,g.trigger(h)}),g.hide().fadeIn(200)},_initDropZone:function(){var a=this;a.options.dropzone&&i(a)},loadTarget:function(b,c){function d(c,d){h||e._loadPendingUid!==b||(h=!0,e._loadPendingUid=null,c||(e.viewActive=d.hide().appendTo(e.viewContents),e.trigger("view",[e.viewActive]),e.trigger("select",[a()]),e.loader.hide(),d.fadeIn("fast")))}var e=this,f=e.options.listIdPrefix+b,g=a("#"+f);if(e.viewActive.data("uid")!==b){if(e.trigger("unselectall"),e.viewActive.fadeOut("fast"),g.length)return e.viewActive=g.fadeIn("fast"),e.trigger("view",[e.viewActive]),void e.trigger("select",[a()]);e.loader.show(),e.viewActive=a(),e._loadPendingUid=b;var h=!1;e.trigger("load",[b,c,d])}}})}(jQuery,window);
//# sourceMappingURL=filehub.min.js.map