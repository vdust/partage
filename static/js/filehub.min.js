(function(c,m,z){function n(c){if(!this._init)return new n(c);this._init.call(this,c)}function t(c){if(!this._init)return new n(c);this._init.call(this,c)}var v=function(){var c=document.createElement("x"),b=document.documentElement,a=m.getComputedStyle;if(!("pointerEvents"in c.style))return!1;c.style.pointerEvents="auto";c.style.pointerEvents="x";b.appendChild(c);a=a&&"auto"===a(c,"").pointerEvents;b.removeChild(c);return!!a}(),q=m.filehubInit=function b(){var a=m.FILEHUB_CTX;a&&"function"===typeof b[a]&&
(m.FILEHUB_OBJ=b[a]())};q.View=n;n.prototype={_init:function(b){this._handlers=b||{};this._body=c(m.document.body);this.nav=c("#nav");this.navPadding=c("#nav-padding");this.navPath=c("#nav-path");this.navTools=c("#nav-tools");this.sidePanel=c("#view-aside");this.buttonBox=this.sidePanel.children(".button-box");this.treeBox=this.sidePanel.children(".tree-box");this.treeIdPrefix=this.treeBox.data("id-prefix")||"t:";this.viewResize=c("#view-resize");this.viewContents=c("#view-contents");this.currentActive=
this.viewContents.children(".list-box:visible");this.loader=this.viewContents.children(".list-loader").hide();this._initResize();this._initSidePanel();this._initLists()},_initResize:function(){var b=this.sidePanel,a=this.navPadding,e,d;this.viewResize.children(".view-handle").on("mousedown",function(f){1===f.which&&(e=b.width(),d=f.pageX,c(m).on("mousemove.resize",function(c){c=Math.max(0,e+(c.pageX-d));b.width(c);a.width(c)}).on("mouseup.resize",function(b){1===b.which&&c(m).off(".resize")}))})},
_initSidePanel:function(){var b=this;b.buttonBox.on("click","button",function(a){a=c(this);var e=a.data("handler");a.prop("disabled")||(e=b._handlers[e],"function"===typeof e&&e.call(b,b.currentActive))});b.treeBox.on("click",".tree-item-subtree > .tree-expand",function(b){c(this).children(".fa").toggleClass("fa-caret-down fa-caret-right");c(this).closest(".tree-item").next(".tree").slideToggle(300)}).on("click",".tree-item",function(a){var e=c(this);if(!c(a.target).closest(".tree-expand").length&&
!e.hasClass("active")){a=e.data("target");var d=e.data("handler");b.loadTarget(a,d,e)}})},treeItemFromTargetId:function(b){return c("#"+self.treeIdPrefix+b)},loadTarget:function(b,a,e){var d=this,f=b?c("#"+b):null;f&&!f.length&&(f=null);a=d._handlers[a];if(f)d.unselectAll(),d.currentActive.fadeOut(200),d.currentActive=f,f.fadeIn(200);else if("function"===typeof a)d.unselectAll(),d.currentActive.fadeOut(200),d.loader.fadeIn(200),a(e,function(a,e){var p=c("<div/>");d.loader.fadeOut(200);e&&console.error(e);
p.html(a||"");f=p.children(".list-box:eq(0)");b&&f.attr("id",b);if(f.length)d.currentActive=f,d.viewContents.append(f.hide().fadeIn(200));else{d.viewContents.children(".error-box").remove();var g={title:"Unexpected error",message:"An unexpected error occured."},k,m;k="error";p.addClass(k+"-box");p.children().length||(g=g||"-",m=c("<h1/>").text("string"===typeof g?g:g.title||"-"),g=g.message?c('<p class="note"/>').text(g.message):c(),g=c('<div class="info-box"/>').append(m,g),k=c("<div/>",{"class":k+
"-wrap"}),k.html('<div class="padding-box1"/><div class="fixed-box"/><div class="padding-box2"/>'),k.children(".fixed-box").append(g),p.append(k));d.currentActive=p;d.viewContents.append(p)}});else{console.error("Unbound tree item (unknown target, no handler)");return}d._treeActivate(e)},_treeActivate:function(b){var a=this._handlers.navUpdate;this.treeBox.find(".active").removeClass("active");b.hasClass("tree-item")&&b.addClass("active");"function"===typeof a&&a.call(this,b)},_dndRow:function(b,
a){var e=c('<div class="dnd-row"/>').toggleClass("dnd-row-other",!!a),d=b.children(".list-cell:eq(0)").children(".list-cell-content"),f;e.append(d.clone());e.data("dnd-row-src",b);this._body.append(e);d=b.offset();f=b.innerWidth();e.offset(d).width(f);e.on("movetopointer.viewdnd",function(b){b={left:b.pageX+1+(a?3:0),top:b.pageY+1+(a?3:0)};v||(b.left+=20);e.offset(b)});return e.get(0)},_dndInit:function(b,a,e,d){var f=this,h=c(),l=c.Event("movetopointer.viewdnd");l.pageX=e;l.pageY=d;a.each(function(a){h=
h.add(f._dndRow(c(this),this!==b.get(0)))});h.width(0).trigger(l);1<h.length&&(a=c('<div class="dnd-count"/>').text(h.length),h.not(".dnd-row-other").append(a.hide().fadeIn()));c(m).on("mousemove.viewdnd",function(b){l.pageX=b.pageX;l.pageY=b.pageY;h.trigger(l)});return h.hide().fadeIn(200)},_initLists:function(){var b=this;c(m.document).on("keydown.list-shortcuts",function(a){if(!b._body.hasClass("on-drag")&&!c(a.target).closest("button,input,textarea").length){var e=a.ctrlKey,d=a.altKey;switch(a.keyCode||
a.which){case 65:e&&!d&&b.selectAll();break;case 46:b.deleteSelected();break;case 13:b.activateSelected()}}});b.viewContents.on("mousedown",".list-row",function(a){function e(a){w.removeClass("list-row-last");v.removeClass("list-row-orig");f.addClass("list-row-last list-row-orig");a||u.removeClass("list-row-selected");f.toggleClass("list-row-selected",l?z:!0);b.updateTools(r.filter(".list-row-selected"))}function d(){var d=null,g=a.pageX,h=a.pageY,k,l;c(m.document).on("keydown.viewdnd",function(a){b._body.toggleClass("on-drag-copy",
a.ctrlKey)}).on("keyup.viewdnd",function(a){b._body.toggleClass("on-drag-copy",a.ctrlKey)});c(m).on("mousemove.viewdnd",function(a){if(!k){k=2<Math.abs(g-a.pageX)+Math.abs(h-a.pageY);if(!k)return;b._body.addClass("on-drag").toggleClass("on-drag-copy",a.ctrlKey);u.addClass("list-row-dragged");l=b._dndInit(f,u,a.pageX,a.pageY)}d&&d.removeClass("view-droppable-hover");a=c(a.target).closest(".view-droppable");a=a.not(".active,.list-row-selected");if(d=a.length?a:null)l.each(function(){var a=c(this).data("dnd-row-src").data("target");
if(a&&a===d.data("target"))return d=null,!1}),d&&d.addClass("view-droppable-hover")}).on("mouseup.viewdnd",function(a){1===a.which&&(u.removeClass("list-row-dragged"),b._body.removeClass("on-drag on-drag-copy"),c(m).off(".viewdnd"),c(m.document).off(".viewdnd"),l&&l.remove(),d?d.removeClass("view-droppable-hover"):k||p||e())})}if(1===a.which){var f=c(this),h=f.is(".list-row-selected"),l=a.ctrlKey,p=a.shiftKey,g=-1,k=-1,n=-1,q,t,x,y,r=f.closest(".list").children(".list-group").children(".list-row"),
w=r.filter(".list-row-last"),v=r.filter(".list-row-orig"),u=r.filter(".list-row-selected");h&&!l&&d();p&&l||(p?(r.each(function(a){var b=c(this);this===f.get(0)&&(n=a);b.hasClass("list-row-last")&&(k=a);b.hasClass("list-row-orig")&&(g=a);return!(0<=k&&0<=g&&0<=n)}),0>n||(g=0>g?0:g,k=0>k?g:k,q=Math.min(g,k),t=Math.max(g,k),x=Math.min(n,g),y=Math.max(n,g),r.each(function(a){var b;a>=q&&a<=t&&(b=!1);a>=x&&a<=y&&(b=!0);"boolean"===typeof b&&c(this).toggleClass("list-row-selected",b)}),w.removeClass("list-row-last"),
f.addClass("list-row-last"),u=r.filter(".list-row-selected"),b.updateTools(u))):!l&&h||e(l))}}).on("dblclick",".list-row",function(a){b.activateSelected(c(this))}).on("mousedown",function(a){1!==a.which||c(a.target).closest(".list-row").length||(a=b.currentActive.children(".list").children(".list-group"),a.children(".list-row-selected").removeClass("list-row-selected"),a.children(".list-row-last").removeClass("list-row-last"),b.updateTools(c()))})},updateTools:function(b){var a;b.each(function(){var b=
c(this).data("type");a=a&&a!==b?"*":b;return"*"!==b});this.navTools.children(".view-action").each(function(){var e=c(this),d=b.length,f=e.data("select"),h=e.data("type");e.toggle(!f||(!h||h===a||"*"===h)&&("always"===f||0<d&&"multi"===f||1==d&&"single"===f))})},_listHandler:function(b,a,c){b=b.closest(".list");if(b.length)return a=this._handlers[b.data(a)||c],"function"===typeof a?a.bind(this):null},getSelected:function(){return this.currentActive.children(".list").children(".list-group").children(".list-row-selected")},
getAll:function(){return this.currentActive.children(".list").children(".list-group").children(".list-row")},rowActivateHandler:function(b){return this._listHandler(b,"row-activate","rowActivate")},rowDeleteHandler:function(b){return this._listHandler(b,"row-delete","rowDelete")},activateSelected:function(b){b=(b||this.getSelected()).eq(0);var a=this.rowActivateHandler(b);b.length&&a&&a(b)},selectAll:function(){var b=this.getAll().addClass("list-row-selected");b.removeClass("list-row-last list-row-orig");
b.eq(0).addClass("list-row-orig");b.eq(-1).addClass("list-row-last");this.updateTools(b)},unselectAll:function(){var b=this.getAll().removeClass("list-row-selected");b.removeClass("list-row-last list-row-orig");b.eq(0).addClass("list-row-orig list-row-last");this.updateTools(c())},deleteSelected:function(){var b=this.getSelected(),a=this.rowDeleteHandler(b);b.length&&(a=a||function(a,b){b()},a(rows,function(a,c){a||b.remove()}))}};q.browse=function(){return new n({rowActivate:function(b){var a,c;
a=b.hasClass("tree-item")?"folder":b.data("type");c=b.data("target");switch(a){case "folder":a=this.treeItemFromTarget(b.data("target")),a.length||(a=b),this.loadTarget(c,"folderQuery",a)}},folderQuery:function(b,a){var c={title:"Not implemented",message:"function not implemented yet."};setTimeout(function(){a("",c)},0)},navUpdate:function(b){b=b.data("url").split("/");var a,e=[],d,f,h;a=this.navPath.children();a.remove();a=a.eq(0);this.navPath.append(a);b.shift();for(d=a.data("base-url");a=b.shift();)a=
decodeURIComponent(a),e.push(a),f=c("<li/>"),c('<span class="fa fa-chevron-right"/>').appendTo(f),h=c('<span class="navitem subdir"/>').appendTo(f),h.data("base-url",d).data("path",e.join("/")),h.text(a),this.navPath.append(f)}})};q.Profile=t;t.prototype={_init:function(b){this._handlers=b}};q.profile=function(){return new t({})};c(q)})(jQuery,window);
