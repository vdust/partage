!function(a,b,c){"use strict";function d(b,c,d){var e,f;return d=d||"message",b.addClass(d+"-box"),b.children().length||(c=c||"-",e=a("<h1/>").text("string"==typeof c?c:c.title||"-"),c=c.message?a('<p class="note"/>').text(c.message):a(),c=a('<div class="info-box"/>').append(e,c),f=a("<div/>").addClass(d+"-wrap"),f.html('<div class="padding-box1"/><div class="fixed-box"/><div class="padding-box2"/>'),f.children(".fixed-box").append(c),b.append(f)),b}function e(a,b){return d(a,{title:b&&b.title||"Unexpected error",message:b&&b.message||"An unexpected error occured."},"error")}function f(a){return this._init?void this._init.call(this,a):new f(a)}function g(a){return this._init?void this._init.call(this,a):new f(a)}var h=b.FILEHUB_BASEURL||"",i=function(){var a,c=document.createElement("x"),d=document.documentElement,e=b.getComputedStyle;return"pointerEvents"in c.style?(c.style.pointerEvents="auto",c.style.pointerEvents="x",d.appendChild(c),a=e&&"auto"===e(c,"").pointerEvents,d.removeChild(c),!!a):!1}(),j=b.filehubInit=function k(){var a=b.FILEHUB_CTX;a&&"function"==typeof k[a]&&(b.FILEHUB_OBJ=k[a]())};j.View=f,f.prototype={_init:function(c){this._handlers=c||{},this._body=a(b.document.body),this.nav=a("#nav"),this.navPadding=a("#nav-padding"),this.navPath=a("#nav-path"),this.navTools=a("#nav-tools"),this.sidePanel=a("#view-aside"),this.buttonBox=this.sidePanel.children(".button-box"),this.treeBox=this.sidePanel.children(".tree-box"),this.treeIdPrefix=this.treeBox.data("id-prefix")||"t-",this.viewResize=a("#view-resize"),this.viewContents=a("#view-contents"),this.currentActive=this.viewContents.children(".list-box:visible"),this.loader=this.viewContents.children(".list-loader").hide(),this._initNav(),this._initResize(),this._initSidePanel(),this._initLists()},_initNav:function(){var a=this._handlers.navInit;"function"==typeof a&&a.call(this)},_initResize:function(){var c,d,e=this.sidePanel,f=this.navPadding,g=this.viewResize.children(".view-handle");g.on("mousedown",function(g){1===g.which&&(c=e.width(),d=g.pageX,a(b).on("mousemove.resize",function(a){var b=a.pageX-d,g=Math.max(0,c+b);e.width(g),f.width(g)}).on("mouseup.resize",function(c){1===c.which&&a(b).off(".resize")}))})},_initSidePanel:function(){var b=this;b.buttonBox.on("click","button",function(c){var d=a(this),e=d.data("handler");d.prop("disabled")||(e=b._handlers[e],"function"==typeof e&&e.call(b,b.currentActive))}),b.treeBox.on("click",".tree-item-subtree > .tree-expand",function(b){var c=a(this).children(".fa");c.toggleClass("fa-caret-down fa-caret-right"),a(this).closest(".tree-item").next(".tree").slideToggle(300)}).on("click",".tree-item",function(c){var d=a(this);if(!a(c.target).closest(".tree-expand").length&&!d.hasClass("active")){var e=d.data("target"),f=d.data("handler");b.loadTarget(e,f,d)}})},_treeActivate:function(a){var b,c=this._handlers.navUpdate;if(this.treeBox.find(".active").removeClass("active"),a.hasClass("tree-item"))for(a.addClass("active"),b=a.parent(".tree");b.length&&!b.is(":visible");)b=b.prev(".tree-item"),b.children(".tree-expand").click(),b=b.parent(".tree");"function"==typeof c&&c.call(this,a)},_dndRow:function(b,c){var d,e,f=a('<div class="dnd-row"/>').toggleClass("dnd-row-other",!!c),g=b.children(".list-cell:eq(0)").children(".list-cell-content");return f.append(g.clone()),f.data("dnd-row-src",b),this._body.append(f),d=b.offset(),e=b.innerWidth(),f.offset(d).width(e),f.on("movetopointer.viewdnd",function(a){var b={left:a.pageX+1+(c?3:0),top:a.pageY+1+(c?3:0)};i||(b.left+=20),f.offset(b)}),f.get(0)},_dndInit:function(c,d,e,f){var g=this,h=a(),i=a.Event("movetopointer.viewdnd");if(i.pageX=e,i.pageY=f,d.each(function(b){h=h.add(g._dndRow(a(this),this!==c.get(0)))}),h.width(0).trigger(i),h.length>1){var j=a('<div class="dnd-count"/>').text(h.length);h.not(".dnd-row-other").append(j.hide().fadeIn())}return a(b).on("mousemove.viewdnd",function(a){i.pageX=a.pageX,i.pageY=a.pageY,h.trigger(i)}),h.hide().fadeIn(200)},_initLists:function(){var d=this;a(b.document).on("keydown.list-shortcuts",function(b){if(!d._body.hasClass("on-drag")&&!a(b.target).closest("button,input,textarea").length){var c=b.ctrlKey,e=b.altKey;b.shiftKey;switch(b.keyCode||b.which){case 65:c&&!e&&d.selectAll();break;case 46:d.deleteSelected();break;case 13:d.activateSelected()}}}),d.viewContents.on("mousedown",".list-row",function(e){function f(a){v.removeClass("list-row-last"),w.removeClass("list-row-orig"),l.addClass("list-row-last list-row-orig"),a||x.removeClass("list-row-selected"),l.toggleClass("list-row-selected",n?c:!0),d.updateTools(u.filter(".list-row-selected"))}function g(){var c,g,h=null,i=e.pageX,j=e.pageY;a(b.document).on("keydown.viewdnd",function(a){d._body.toggleClass("on-drag-copy",a.ctrlKey)}).on("keyup.viewdnd",function(a){d._body.toggleClass("on-drag-copy",a.ctrlKey)}),a(b).on("mousemove.viewdnd",function(b){var e;if(!c){if(c=Math.abs(i-b.pageX)+Math.abs(j-b.pageY)>2,!c)return;d._body.addClass("on-drag").toggleClass("on-drag-copy",b.ctrlKey),x.addClass("list-row-dragged"),g=d._dndInit(l,x,b.pageX,b.pageY)}h&&h.removeClass("view-droppable-hover"),e=a(b.target).closest(".view-droppable"),e=e.not(".active,.list-row-selected"),h=e.length?e:null,h&&(g.each(function(){var b=a(this).data("dnd-row-src"),c=b.data("target");return c&&c===h.data("target")?(h=null,!1):void 0}),h&&h.addClass("view-droppable-hover"))}).on("mouseup.viewdnd",function(e){1===e.which&&(x.removeClass("list-row-dragged"),d._body.removeClass("on-drag on-drag-copy"),a(b).off(".viewdnd"),a(b.document).off(".viewdnd"),g&&g.remove(),h?h.removeClass("view-droppable-hover"):c||o||f())})}if(1===e.which){var h,i,j,k,l=a(this),m=l.is(".list-row-selected"),n=e.ctrlKey,o=e.shiftKey,p=-1,q=-1,r=-1,s=l.closest(".list"),t=s.children(".list-group"),u=t.children(".list-row"),v=u.filter(".list-row-last"),w=u.filter(".list-row-orig"),x=u.filter(".list-row-selected");if(m&&!n&&g(),!o||!n)if(o){if(u.each(function(b){var c=a(this);return this===l.get(0)&&(r=b),c.hasClass("list-row-last")&&(q=b),c.hasClass("list-row-orig")&&(p=b),!(q>=0&&p>=0&&r>=0)}),0>r)return;p=0>p?0:p,q=0>q?p:q,h=Math.min(p,q),i=Math.max(p,q),j=Math.min(r,p),k=Math.max(r,p),u.each(function(b){var c;b>=h&&i>=b&&(c=!1),b>=j&&k>=b&&(c=!0),"boolean"==typeof c&&a(this).toggleClass("list-row-selected",c)}),v.removeClass("list-row-last"),l.addClass("list-row-last"),x=u.filter(".list-row-selected"),d.updateTools(x)}else!n&&m||f(n)}}).on("dblclick",".list-row",function(b){d.activateSelected(a(this))}).on("mousedown",function(b){if(1===b.which){var c;a(b.target).closest(".list-row").length||(c=d.currentActive.children(".list").children(".list-group"),c.children(".list-row-selected").removeClass("list-row-selected"),c.children(".list-row-last").removeClass("list-row-last"),d.updateTools(a()))}})},_listHandler:function(a,b,c){var d,e=a.closest(".list");if(e.length)return d=this._handlers[e.data(b)||c],"function"==typeof d?d.bind(this):null},treeItemFromTargetId:function(b){return a(document.getElementById(this.treeIdPrefix+b))},loadTarget:function(b,c,d){var f=this,g=b?a(document.getElementById(b)):null;if(g&&!g.length&&(g=null),c=f._handlers[c],g)f.unselectAll(),f.currentActive.fadeOut(200),f.currentActive=g,g.fadeIn(200);else{if("function"!=typeof c)return void console.error("Unbound tree item (unknown target, no handler)");f.unselectAll(),f.currentActive.fadeOut(200),f.loader.fadeIn(200),c(d,function(c,d){var h=a("<div/>");f.loader.fadeOut(200),h.html(c||""),g=h.children(".list-box:eq(0)"),b&&g.attr("id",b),g.length?(f.currentActive=g,f.viewContents.append(g.hide().fadeIn(200))):(f.viewContents.children(".error-box").remove(),f.currentActive=e(h,d),f.viewContents.append(h))})}f._treeActivate(d)},updateTools:function(b){var c,d=b.closest(".list-box");b.each(function(){var b=a(this),d=b.data("type");return c=c&&c!==d?"_mixed_":d,"_mixed_"!==d}),this.navTools.children(".view-action").each(function(){var e=a(this),f=b.length,g=!1,h=e.data("select"),i=e.data("type").split("|"),j=i[1];i=i[0],j&&!d.is(j)||(g=!h||(!i||"*"===i||i===c)&&("always"===h||f>0&&"multi"===h||1==f&&"single"===h)),e.toggle(g)})},treeGetPathTo:function(b){for(var c,d=[],e=a(b);e.length&&e.hasClass("tree-item");)d.unshift(e.get(0)),c=e.parent(".tree"),e=c.prev(".tree-item");return a(d)},getSelected:function(){return this.currentActive.children(".list").children(".list-group").children(".list-row-selected")},getAll:function(){return this.currentActive.children(".list").children(".list-group").children(".list-row")},rowActivateHandler:function(a){return this._listHandler(a,"row-activate","rowActivate")},rowDeleteHandler:function(a){return this._listHandler(a,"row-delete","rowDelete")},activateSelected:function(a){var b=(a||this.getSelected()).eq(0),c=this.rowActivateHandler(b);b.length&&c&&c(b)},selectAll:function(){var a=this.getAll().addClass("list-row-selected");a.removeClass("list-row-last list-row-orig"),a.eq(0).addClass("list-row-orig"),a.eq(-1).addClass("list-row-last"),this.updateTools(a)},unselectAll:function(){var b=this.getAll().removeClass("list-row-selected");b.removeClass("list-row-last list-row-orig"),b.eq(0).addClass("list-row-orig list-row-last"),this.updateTools(a())},deleteSelected:function(){var a=this.getSelected(),b=this.rowDeleteHandler(a);a.length&&(b=b||function(a,b){b()})(rows,function(b,c){b||a.remove()})}},j.browse=function(){var b={};return b.rowActivate=function(a){var b,c,d;switch(b=a.hasClass("tree-item")?"folder":a.data("type"),d=a.data("target"),b){case"folder":c=this.treeItemFromTargetId(d),c.length||(c=a),this.loadTarget(d,"folderQuery",c);break;case"file":}},b.folderQuery=function(b,c){a.get(h+"/"+b.data("url"),{"list-only":1},function(a,b){c(a)}).fail(function(){console.log(arguments),c("",{title:"Resource unavailable",message:"failed to retrieve the requested resource."})})},b.navUpdate=function(b){var c,d,e,f,g,h,i=b.data("url").split("/"),j=[],k=this.navPath.children();for(k.remove(),k=k.eq(0),this.navPath.append(k),k.children(".navitem").data("path",""),h=this.treeGetPathTo(b),h.length&&(h=h.eq(0),k.children(".navitem").text(h.children(".tree-label").text())),i.shift(),d=k.children(".navitem").data("base-url");c=i.shift();){if(c=decodeURIComponent(c),"."===c[0])return void k.children(".navitem").data("path",c);j.push(c),e=a("<li/>"),f=a('<span class="fa fa-chevron-right"/>').appendTo(e),g=a('<span class="navitem subdir"/>').appendTo(e),g.data("base-url",d).data("path",j.join("/")),g.text(c),this.navPath.append(e)}},new f(b)},j.Profile=g,g.prototype={_init:function(a){this._handlers=a}},j.profile=function(){var a={};return new g(a)},a(j)}(jQuery,window);
//# sourceMappingURL=filehub.min.js.map